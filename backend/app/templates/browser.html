{% extends "base.html" %}

{% block title %}Rules Browser - Suricata Rule Browser{% endblock %}

{% block content %}
<div class="stats-section" id="stats">
    <div class="stat-card">
        <div class="stat-value" id="total-rules">0</div>
        <div class="stat-label">Total Rules</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="filtered-rules">0</div>
        <div class="stat-label">Filtered Rules</div>
    </div>
</div>

<div class="controls-section">
    <div class="search-box">
        <input
            type="text"
            id="search-input"
            placeholder="Search rules (message, SID, tags)..."
            autocomplete="off"
        >
        <button id="search-btn" class="btn btn-primary">Search</button>
        <button id="clear-btn" class="btn btn-secondary">Clear</button>
    </div>

    <div class="filters">
        <div class="filter-group">
            <label for="action-filter">Action:</label>
            <select id="action-filter" multiple></select>
        </div>

        <div class="filter-group">
            <label for="protocol-filter">Protocol:</label>
            <select id="protocol-filter" multiple></select>
        </div>

        <div class="filter-group">
            <label for="source-filter">Source:</label>
            <select id="source-filter" multiple></select>
        </div>

        <div class="filter-group">
            <label for="category-filter">Category:</label>
            <select id="category-filter" multiple></select>
        </div>

        <div class="filter-group">
            <label for="classtype-filter">Class Type:</label>
            <select id="classtype-filter" multiple></select>
        </div>

        <div class="filter-group">
            <label for="severity-filter">Severity:</label>
            <select id="severity-filter" multiple></select>
        </div>

        <div class="filter-group">
            <label for="attack-target-filter">Attack Target:</label>
            <select id="attack-target-filter" multiple></select>
        </div>

        <div class="filter-group">
            <label for="deployment-filter">Deployment:</label>
            <select id="deployment-filter" multiple></select>
        </div>

        <div class="filter-group">
            <label for="affected-product-filter">Affected Product:</label>
            <select id="affected-product-filter" multiple></select>
        </div>

        <div class="filter-group">
            <label for="confidence-filter">Confidence:</label>
            <select id="confidence-filter" multiple></select>
        </div>

        <div class="filter-group">
            <label for="performance-filter">Performance Impact:</label>
            <select id="performance-filter" multiple></select>
        </div>

        <div class="filter-group">
            <label for="enabled-filter">Status:</label>
            <select id="enabled-filter" multiple></select>
        </div>
    </div>
</div>

<div class="results-section">
    <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
        <p>Loading rules...</p>
    </div>

    <div id="error-message" class="error-message" style="display: none;"></div>

    <div class="table-controls">
        <div class="pagination pagination-top" id="pagination-top">
            <button id="prev-page-top" class="btn-pagination">‹</button>
            <span class="page-info">
                Page <input type="number" id="page-input-top" class="page-input" min="1" value="1"> of <span id="total-pages-top">1</span>
            </span>
            <button id="next-page-top" class="btn-pagination">›</button>
            <select id="page-size-top" class="page-size-select">
                <option value="25">25 per page</option>
                <option value="50" selected>50 per page</option>
                <option value="100">100 per page</option>
                <option value="200">200 per page</option>
                <option value="500">500 per page</option>
            </select>
        </div>

        <div class="column-toggle-wrapper">
            <button id="column-toggle-btn" class="btn-column-toggle" title="Configure columns">⚙</button>
            <div id="column-dropdown" class="column-dropdown" style="display: none;">
                <div class="column-dropdown-header">Show/Hide Columns</div>
                <label class="column-option">
                    <input type="checkbox" data-column="sid">
                    <span>SID</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="action">
                    <span>Action</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="status">
                    <span>Status</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="protocol" checked>
                    <span>Protocol</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="message" checked>
                    <span>Message</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="source" checked>
                    <span>Source</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="category" checked>
                    <span>Category</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="classtype" checked>
                    <span>Class Type</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="severity">
                    <span>Severity</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="attack_target">
                    <span>Attack Target</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="deployment">
                    <span>Deployment</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="affected_product">
                    <span>Affected Product</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="confidence">
                    <span>Confidence</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="performance">
                    <span>Performance Impact</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="network" checked>
                    <span>Network</span>
                </label>
                <label class="column-option">
                    <input type="checkbox" data-column="revision">
                    <span>Revision</span>
                </label>
            </div>
        </div>
    </div>

    <div class="table-wrapper">
        <table id="rules-table" class="rules-table">
            <thead>
                <tr>
                    <th data-column="sid" data-sort="sid" class="sortable resizable">SID <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="action" data-sort="action" class="sortable resizable">Action <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="status" data-sort="enabled" class="sortable resizable" style="display: none;">Status <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="protocol" data-sort="protocol" class="sortable resizable">Protocol <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="message" data-sort="msg" class="sortable resizable">Message <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="source" data-sort="source" class="sortable resizable">Source <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="category" data-sort="category" class="sortable resizable">Category <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="classtype" data-sort="classtype" class="sortable resizable">Class Type <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="severity" data-sort="severity" class="sortable resizable" style="display: none;">Severity <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="attack_target" data-sort="attack_target" class="sortable resizable" style="display: none;">Attack Target <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="deployment" data-sort="deployment" class="sortable resizable" style="display: none;">Deployment <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="affected_product" data-sort="affected_product" class="sortable resizable" style="display: none;">Affected Product <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="confidence" data-sort="confidence" class="sortable resizable" style="display: none;">Confidence <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="performance" data-sort="performance" class="sortable resizable" style="display: none;">Performance Impact <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                    <th data-column="network" class="resizable">Network<div class="resize-handle"></div></th>
                    <th data-column="revision" data-sort="rev" class="sortable resizable" style="display: none;">Revision <span class="sort-indicator"></span><div class="resize-handle"></div></th>
                </tr>
            </thead>
            <tbody id="rules-list"></tbody>
        </table>
    </div>
</div>

<div class="pagination pagination-bottom" id="pagination-bottom">
    <button id="prev-page-bottom" class="btn-pagination">‹</button>
    <span class="page-info">
        Page <input type="number" id="page-input-bottom" class="page-input" min="1" value="1"> of <span id="total-pages-bottom">1</span>
    </span>
    <button id="next-page-bottom" class="btn-pagination">›</button>
    <select id="page-size-bottom" class="page-size-select">
        <option value="25">25 per page</option>
        <option value="50" selected>50 per page</option>
        <option value="100">100 per page</option>
        <option value="200">200 per page</option>
        <option value="500">500 per page</option>
    </select>
</div>
{% endblock %}

{% block modals %}
<!-- Rule Detail Modal -->
<div id="rule-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="rule-detail"></div>
    </div>
</div>
{% endblock %}
